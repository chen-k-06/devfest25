<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>AccessibleColumbia</title>
  <link href="style.css" rel="stylesheet" type="text/css" />
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
  </style>
</head>

<body>
  <!-- Nav Bar! -->
  <nav>
    <div class="headerBar">
      <h1 class="title">Accessible Columbia</h1>
    </div>
  </nav>
  <!-- End of NavBar -->

  <div class="container">
    <p class="greeting"> Welcome to Accessible Columbia! <br> Columbia University's Morningside Campus is one of the
      least navigable and accessible campuses we have ever been on. To fix this, Accessible Columbia aims to compile all
      information in one place so you can get to your classes and get around campus safely and accessibly!
    </p>
  </div>

  <!-- Start and End Search Bar -->
  <input id="searchBarStart" type="text" placeholder="Enter Start Location..."
    style="width: 80%; padding: 10px; margin: 10px auto; display: block; font-size: 16px;">
  <input id="searchBarEnd" type="text" placeholder="Enter End Location..."
    style="width: 80%; padding: 10px; margin: 10px auto; display: block; font-size: 16px;">

  <div id="map"></div>

  <!-- Load Google Maps API -->
  <script src="script.js"></script>
  <script src="map.js"></script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAXYcZIS7fXp0_jMgZpzTECXy32QVVnOzk&callback=initMap&libraries=places"
    async defer></script>

  <script>
    let map, directionsService, directionsRenderer, startAutocomplete, endAutocomplete;

    function initMap() {
      // Initialize map
      const campusCenter = { lat: 40.809008176956404, lng: -73.96384528956837 };
      map = new google.maps.Map(document.getElementById("map"), {
        zoom: 16,
        center: campusCenter,
      });

      // Initialize Directions Service and Renderer
      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer();
      directionsRenderer.setMap(map);

      // Set up Autocomplete for start and end locations
      startAutocomplete = new google.maps.places.Autocomplete(document.getElementById("searchBarStart"));
      endAutocomplete = new google.maps.places.Autocomplete(document.getElementById("searchBarEnd"));

      // Listen for place changes to calculate the route
      startAutocomplete.addListener("place_changed", calculateRoute);
      endAutocomplete.addListener("place_changed", calculateRoute);
    }

    function calculateRoute() {
      const startPlace = startAutocomplete.getPlace();
      const endPlace = endAutocomplete.getPlace();

      if (!startPlace || !endPlace) {
        alert("Please select both start and destination locations.");
        return;
      }

      const start = startPlace.geometry.location;
      const end = endPlace.geometry.location;

      // Set up the directions request for walking
      const request = {
        origin: start,
        destination: end,
        travelMode: google.maps.TravelMode.WALKING,
      };

      // Calculate and render the route
      directionsService.route(request, (result, status) => {
        if (status === google.maps.DirectionsStatus.OK) {
          directionsRenderer.setDirections(result);

          // Optionally display walking time
          const walkingTime = result.routes[0].legs[0].duration.text;
          alert(`Estimated Walking Time: ${walkingTime}`);
        } else {
          alert("Could not retrieve directions. Please check your inputs.");
        }
      });
    }
  </script>

</body>

</html>